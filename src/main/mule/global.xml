<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns:tls="http://www.mulesoft.org/schema/mule/tls"
	xmlns:secure-properties="http://www.mulesoft.org/schema/mule/secure-properties"
      xmlns:salesforce="http://www.mulesoft.org/schema/mule/salesforce"
      xmlns:google-sheets="http://www.mulesoft.org/schema/mule/google-sheets"
      xmlns:file="http://www.mulesoft.org/schema/mule/file"
      xmlns:validation="http://www.mulesoft.org/schema/mule/validation"
      xmlns:apikit="http://www.mulesoft.org/schema/mule/mule-apikit"
      xmlns:http="http://www.mulesoft.org/schema/mule/http"
      xmlns="http://www.mulesoft.org/schema/mule/core"
      xmlns:doc="http://www.mulesoft.org/schema/mule/documentation"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="
http://www.mulesoft.org/schema/mule/tls http://www.mulesoft.org/schema/mule/tls/current/mule-tls.xsd 
http://www.mulesoft.org/schema/mule/secure-properties http://www.mulesoft.org/schema/mule/secure-properties/current/mule-secure-properties.xsd
http://www.mulesoft.org/schema/mule/salesforce http://www.mulesoft.org/schema/mule/salesforce/current/mule-salesforce.xsd
http://www.mulesoft.org/schema/mule/google-sheets http://www.mulesoft.org/schema/mule/google-sheets/current/mule-google-sheets.xsd
http://www.mulesoft.org/schema/mule/file http://www.mulesoft.org/schema/mule/file/current/mule-file.xsd
http://www.mulesoft.org/schema/mule/validation http://www.mulesoft.org/schema/mule/validation/current/mule-validation.xsd
http://www.mulesoft.org/schema/mule/mule-apikit http://www.mulesoft.org/schema/mule/mule-apikit/current/mule-apikit.xsd
http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd
http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd">

    <!-- Configuration Properties -->
    <configuration-properties file="properties/${mule.env}.properties" />
    <global-property name="mule.env" value="dev" doc:name="Global Property" />

    <!-- HTTP Listener Configuration -->
    <http:listener-config name="sales-order-system-api-httpListenerConfig">
        <http:listener-connection host="${http.host}" port="${http.port}" />
    </http:listener-config>
    
    <!-- <http:listener-config name="HTTP_Listener_config1">
        <http:listener-connection host="0.0.0.0" port="${http.port}" protocol="HTTPS">
			<tls:context >
				<tls:key-store type="jks" path="keystore.jks" alias="my-https-cert" keyPassword="changeit" password="changeit" />
			</tls:context>
		</http:listener-connection>
    </http:listener-config> -->

    <!-- APIkit Configuration -->
    <apikit:config name="sales-order-system-api-config" api="sales-order-system-api.raml" outboundHeadersMapName="outboundHeaders" httpStatusVarName="httpStatus" />

    <!-- Google Sheets Configuration -->
    <!-- <google-sheets:config name="Google_Sheets_Config">
        <google-sheets:oauth-2-0-connection >
            <google-sheets:oauth-authorization-code 
                consumerKey="${google.sheets.client.id}" 
                consumerSecret="${google.sheets.client.secret}" 
                refreshToken="${google.sheets.refresh.token}" />
        </google-sheets:oauth-2-0-connection>
    </google-sheets:config>
 -->
 
	 <google-sheets:config name="Google_Sheets_Config" doc:name="Google Sheets Config" doc:id="f8076450-3456-4c0d-a562-489c3eb0feaf" >
			<google-sheets:oauth-2-0-connection >
				<google-sheets:oauth-authorization-code consumerKey="${googlesheet.clientid}" consumerSecret="${googlesheet.clientsecret}" scopes="https://www.googleapis.com/auth/spreadsheets https://www.googleapis.com/auth/spreadsheets.readonly"/>
				<google-sheets:oauth-callback-config listenerConfig="sales-order-system-api-httpListenerConfig" callbackPath="${googlesheet.callbackPath}" authorizePath="${googlesheet.authorizePath}" externalCallbackUrl="${googlesheet.externalCallbackUrl}" />
				
			
	</google-sheets:oauth-2-0-connection>
		</google-sheets:config>
 
    <!-- Salesforce Configuration -->
    <salesforce:sfdc-config name="Salesforce_Config" doc:name="Salesforce Config" doc:id="921af870-e1ea-4aa9-af24-05c18ca96abc" >
		<salesforce:basic-connection username="${salesforce.username}" password="${salesforce.password}" securityToken="${salesforce.token}" url="https://login.salesforce.com/services/Soap/u/63.0" >
			<reconnection >
				<reconnect-forever />
			</reconnection>
		</salesforce:basic-connection>
	</salesforce:sfdc-config>
	
    <!-- File Configuration -->

    <!-- Global Error Handler -->
    <error-handler name="global-error-handler">
        <on-error-propagate type="ANY" logException="true">
            <logger level="ERROR" message="Error occurred: #[error.description]" />
            <set-variable variableName="httpStatus" value="500" />
            <set-payload value="#[{
                'code': error.errorType.identifier,
                'message': error.description,
                'timestamp': now(),
                'details': error.detailedDescription default ''
            }]" />
            <set-variable variableName="outboundHeaders" value="#[{'Content-Type': 'application/json'}]" />
        </on-error-propagate>
    </error-handler>

    <!-- Global Configuration -->
    <configuration defaultErrorHandler-ref="global-error-handler" />

    <!-- API Key Validation -->
    <validation:config name="Validation_Config" />

</mule>